# RF04, RF05, RF06 - Documentação das APIs

Esta documentação descreve os endpoints implementados para os requisitos funcionais RF04 (Gerenciamento de Voluntários), RF05 (Preferências de Atuação) e RF06 (Sistema de Tarefas).

## Voluntários (Volunteers)

### POST /volunteers
Cria um novo voluntário no sistema.

**Request Body:**
```json
{
  "name": "João Silva",
  "cpf": "12345678901",
  "email": "joao.silva@email.com",
  "phone": "11987654321",
  "skills": ["cuidados com filhotes", "treinamento", "veterinária"]
}
```

**Response (201 Created):**
```json
{
  "id": 1,
  "name": "João Silva",
  "cpf": "12345678901",
  "email": "joao.silva@email.com",
  "phone": "11987654321",
  "skills": ["cuidados com filhotes", "treinamento", "veterinária"],
  "created_at": "2025-01-05T10:30:00.000Z",
  "updated_at": "2025-01-05T10:30:00.000Z"
}
```

**Erros:**
- `409 Conflict`: CPF ou email já cadastrado
- `400 Bad Request`: Dados inválidos

---

### GET /volunteers
Lista todos os voluntários cadastrados.

**Response (200 OK):**
```json
[
  {
    "id": 1,
    "name": "João Silva",
    "cpf": "12345678901",
    "email": "joao.silva@email.com",
    "phone": "11987654321",
    "skills": ["cuidados com filhotes", "treinamento"],
    "created_at": "2025-01-05T10:30:00.000Z",
    "updated_at": "2025-01-05T10:30:00.000Z"
  }
]
```

---

### GET /volunteers/:id
Obtém detalhes de um voluntário específico.

**Response (200 OK):**
```json
{
  "id": 1,
  "name": "João Silva",
  "cpf": "12345678901",
  "email": "joao.silva@email.com",
  "phone": "11987654321",
  "skills": ["cuidados com filhotes", "treinamento"],
  "preferences": [
    {
      "id": 1,
      "preference": "cães idosos"
    }
  ],
  "tasks": [
    {
      "id": 5,
      "title": "Banho nos cachorros",
      "status": "assigned"
    }
  ],
  "created_at": "2025-01-05T10:30:00.000Z",
  "updated_at": "2025-01-05T10:30:00.000Z"
}
```

**Erros:**
- `404 Not Found`: Voluntário não encontrado

---

### PUT /volunteers/:id
Atualiza dados de um voluntário.

**Request Body (todos os campos opcionais):**
```json
{
  "name": "João Pedro Silva",
  "phone": "11999999999",
  "skills": ["cuidados com filhotes", "veterinária", "adoção"]
}
```

**Response (200 OK):**
```json
{
  "id": 1,
  "name": "João Pedro Silva",
  "cpf": "12345678901",
  "email": "joao.silva@email.com",
  "phone": "11999999999",
  "skills": ["cuidados com filhotes", "veterinária", "adoção"],
  "created_at": "2025-01-05T10:30:00.000Z",
  "updated_at": "2025-01-05T11:45:00.000Z"
}
```

**Erros:**
- `404 Not Found`: Voluntário não encontrado
- `409 Conflict`: CPF ou email já cadastrado

---

### DELETE /volunteers/:id
Remove um voluntário do sistema.

**Response (204 No Content)**

**Erros:**
- `404 Not Found`: Voluntário não encontrado

---

### GET /volunteers/:id/tasks
Lista todas as tarefas atribuídas a um voluntário específico.

**Response (200 OK):**
```json
[
  {
    "id": 5,
    "title": "Banho nos cachorros",
    "description": "Dar banho em todos os cachorros da baia 3",
    "status": "assigned",
    "target_entity": "baia 3",
    "due_date": "2025-01-10T14:00:00.000Z",
    "assigned_to": {
      "id": 1,
      "name": "João Silva"
    },
    "created_at": "2025-01-05T10:00:00.000Z",
    "updated_at": "2025-01-05T10:30:00.000Z"
  }
]
```

**Erros:**
- `404 Not Found`: Voluntário não encontrado

---

## Preferências (Preferences)

### POST /volunteers/:id/preferences
Registra uma lista de preferências para um voluntário.

**Request Body:**
```json
{
  "preferences": ["filhotes", "cães idosos", "gatos resgatados"]
}
```

**Response (201 Created):**
```json
[
  {
    "id": 1,
    "volunteerId": 1,
    "preference": "filhotes",
    "created_at": "2025-01-05T10:30:00.000Z",
    "updated_at": "2025-01-05T10:30:00.000Z"
  },
  {
    "id": 2,
    "volunteerId": 1,
    "preference": "cães idosos",
    "created_at": "2025-01-05T10:30:00.000Z",
    "updated_at": "2025-01-05T10:30:00.000Z"
  },
  {
    "id": 3,
    "volunteerId": 1,
    "preference": "gatos resgatados",
    "created_at": "2025-01-05T10:30:00.000Z",
    "updated_at": "2025-01-05T10:30:00.000Z"
  }
]
```

**Erros:**
- `404 Not Found`: Voluntário não encontrado
- `400 Bad Request`: Lista de preferências vazia ou inválida

---

### GET /volunteers/:id/preferences
Lista todas as preferências de um voluntário.

**Response (200 OK):**
```json
[
  {
    "id": 1,
    "volunteerId": 1,
    "preference": "filhotes",
    "created_at": "2025-01-05T10:30:00.000Z",
    "updated_at": "2025-01-05T10:30:00.000Z"
  }
]
```

**Erros:**
- `404 Not Found`: Voluntário não encontrado

---

### DELETE /volunteers/:id/preferences/:prefId
Remove uma preferência específica de um voluntário.

**Response (204 No Content)**

**Erros:**
- `404 Not Found`: Preferência não encontrada

---

## Tarefas (Tasks)

### POST /tasks
Cria uma nova tarefa no sistema.

**Request Body:**
```json
{
  "title": "Limpar canil setor A",
  "description": "Realizar limpeza completa do canil setor A incluindo troca de água e alimentação",
  "target_entity": "canil setor A",
  "due_date": "2025-01-15T14:00:00.000Z"
}
```

**Response (201 Created):**
```json
{
  "id": 10,
  "title": "Limpar canil setor A",
  "description": "Realizar limpeza completa do canil setor A incluindo troca de água e alimentação",
  "status": "pending",
  "target_entity": "canil setor A",
  "due_date": "2025-01-15T14:00:00.000Z",
  "assigned_to": null,
  "created_at": "2025-01-05T10:30:00.000Z",
  "updated_at": "2025-01-05T10:30:00.000Z"
}
```

**Erros:**
- `400 Bad Request`: Dados inválidos ou status "pending" não configurado

---

### GET /tasks
Lista todas as tarefas com filtros opcionais.

**Query Parameters:**
- `status` (opcional): Filtra por status (pending, assigned, completed)
- `assigned_to` (opcional): Filtra por ID do voluntário

**Exemplos:**
- `GET /tasks` - Lista todas as tarefas
- `GET /tasks?status=pending` - Lista apenas tarefas pendentes
- `GET /tasks?assigned_to=1` - Lista tarefas do voluntário com ID 1
- `GET /tasks?status=assigned&assigned_to=1` - Lista tarefas atribuídas ao voluntário 1

**Response (200 OK):**
```json
[
  {
    "id": 10,
    "title": "Limpar canil setor A",
    "description": "Realizar limpeza completa do canil setor A",
    "status": "pending",
    "target_entity": "canil setor A",
    "due_date": "2025-01-15T14:00:00.000Z",
    "assigned_to": null,
    "created_at": "2025-01-05T10:30:00.000Z",
    "updated_at": "2025-01-05T10:30:00.000Z"
  }
]
```

---

### POST /tasks/:id/assign
Atribui uma tarefa a um voluntário.

**Request Body:**
```json
{
  "volunteer_id": 1
}
```

**Response (200 OK):**
```json
{
  "id": 10,
  "title": "Limpar canil setor A",
  "description": "Realizar limpeza completa do canil setor A",
  "status": "assigned",
  "target_entity": "canil setor A",
  "due_date": "2025-01-15T14:00:00.000Z",
  "assigned_to": {
    "id": 1,
    "name": "João Silva"
  },
  "created_at": "2025-01-05T10:30:00.000Z",
  "updated_at": "2025-01-05T11:00:00.000Z"
}
```

**Erros:**
- `404 Not Found`: Tarefa ou voluntário não encontrado
- `400 Bad Request`: Dados inválidos

---

### PATCH /tasks/:id/complete
Marca uma tarefa como concluída.

**Response (200 OK):**
```json
{
  "id": 10,
  "title": "Limpar canil setor A",
  "description": "Realizar limpeza completa do canil setor A",
  "status": "completed",
  "target_entity": "canil setor A",
  "due_date": "2025-01-15T14:00:00.000Z",
  "assigned_to": {
    "id": 1,
    "name": "João Silva"
  },
  "created_at": "2025-01-05T10:30:00.000Z",
  "updated_at": "2025-01-05T16:30:00.000Z"
}
```

**Erros:**
- `404 Not Found`: Tarefa não encontrada
- `400 Bad Request`: Tarefa já foi concluída

---

## Status de Tarefas

O sistema utiliza três status principais para tarefas:
- **pending**: Tarefa criada, aguardando atribuição
- **assigned**: Tarefa atribuída a um voluntário
- **completed**: Tarefa concluída

## Validações

### Voluntários
- CPF deve ter exatamente 11 dígitos numéricos
- Email deve ser válido
- CPF e email devem ser únicos no sistema

### Preferências
- A lista de preferências não pode estar vazia
- Cada preferência deve ser uma string válida

### Tarefas
- Título e descrição são obrigatórios
- Não é possível atribuir tarefa a voluntário inexistente
- Não é possível marcar como concluída uma tarefa já concluída
- Data de vencimento (due_date) deve estar no formato ISO 8601

## Códigos de Status HTTP

- `200 OK`: Requisição bem-sucedida
- `201 Created`: Recurso criado com sucesso
- `204 No Content`: Recurso removido com sucesso
- `400 Bad Request`: Requisição inválida
- `404 Not Found`: Recurso não encontrado
- `409 Conflict`: Conflito (CPF/email duplicado)
